.row
  -@books.each do |book|
    .book-list 
      .row-eq-height
        .col-sm-3
          .title
            -if book.persisted?
              = link_to book_path(book) do
                p= book.title  
            -else
              p= book.title
          .image.text-center
            = image_tag book.image_url
          .author
            p= book.author
          .publisher
            p= book.publishername

          .star-average
            -if book.persisted?
              div id="star-rate_#{book.id}"
                javascript:
                  $("#star-rate_#{book.id}").raty({
                    path: '/assets/',
                    half: true,
                    readOnly: true,
                    score: #{book.microposts.average(:rate).to_f.round(1)}
                  });
              .record
                ="（レビュー#{book.microposts.count}件）"

          .record
            -if logged_in? 
                = form_with(model:@bookshelf, local:true) do |f|
                  = f.hidden_field :book_id, value: book.id
                  = f.submit '本棚追加', class:'btn btn-primary'
                  
              
          div class="add add_#{book.id}"
            -if logged_in?
              -if book.persisted?
                =render 'likes/like', book: book
              -else
                = form_with(model:@book,local:true,url:books_path) do |f|
                  = hidden_field_tag :isbn, book['isbn']
                  = f.submit '新規書籍追加', class:'btn btn-primary'